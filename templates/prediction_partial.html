<form class="mb-4" method="POST" action="{{ url_for('prediction') }}" hx-post="{{ url_for('prediction') }}" hx-trigger="change" hx-swap="outerHTML">
    <!-- Arm selection buttons -->
    <label for="arm" class="form-label">Choose arm for the prediction:</label>
    <div class="btn-group btn-group-toggle mb-2 w-100" data-toggle="buttons">
        <label class="btn btn-primary w-50 {{ 'active' if arm == 'right' else '' }}">
            <input type="radio" name="arm" id="armRight" value="right" autocomplete="off" {{ 'checked' if arm == 'right' else '' }} class="visually-hidden">Right arm
        </label>
        <label class="btn btn-primary w-50 {{ 'active' if arm == 'left' else '' }}">
            <input type="radio" name="arm" id="armLeft" value="left" autocomplete="off" {{ 'checked' if arm == 'left' else '' }} class="visually-hidden">Left arm
        </label>
    </div>

    <!-- Armwrestler selection dropdowns -->
    <div class="row mb-2">
        <div class="col">
            <label for="armwrestler1" class="form-label">Armwrestler 1:</label>
            <select class="form-select text-truncate" id="armwrestler1" name="armwrestler1" required>
                <option value="none">Choose</option>
                {% for armwrestler in armwrestlers %}
                    <option value="{{ armwrestler[0] }}" {% if selected_armwrestler_1 == armwrestler[0] %}selected{% endif %}>{{ armwrestler[0] }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-1 d-flex justify-content-center align-items-center pt-4">
            <div class="text-center fs-5">
                <span class="badge bg-dark">VS</span>
            </div>
        </div>

        <div class="col">
            
            <label for="armwrestler2" class="form-label">Armwrestler 2:</label>
            {% if selected_armwrestler_1 != 'none' %}
                <select class="form-select text-truncate" id="armwrestler2" name="armwrestler2" required>
                    <option value="none">Choose</option>
                    {% for armwrestler in armwrestlers_2 %}
                        <option value="{{ armwrestler[0] }}" {% if selected_armwrestler_2 == armwrestler[0] %}selected{% endif %}>{{ armwrestler[0] }}</option>
                    {% endfor %}
                </select>
            {% else %}
                <select class="form-select text-truncate" id="armwrestler2" name="armwrestler2" required disabled>
                    <option value="none">Choose Armwrestler 1</option>
                </select>
            {% endif %}
            
            
        </div>
    </div>

    {% if prediction_ready %}
    <label for="current_elo" class="form-label mb-2">Current ELO:</label>
    <div class="row mb-2">
        <div class="col"></div>

        <div class="col d-flex justify-content-center align-items-center">
            <div class="text-center fs-5">
                <span class="text-{{ armwrestler_color[0] }}">{{armwrestler_1_elo}}</span>
            </div>
        </div>
        
        <div class="col-1 d-flex justify-content-center align-items-center text-center fs-2">:</div>

        <div class="col d-flex justify-content-center align-items-center">
            <div class="text-center fs-5">
                <span class="text-{{ armwrestler_color[1] }}">{{armwrestler_2_elo}}</span>
            </div>
        </div>

        <div class="col"></div>
    </div>
    <label for="exprected_score" class="form-label mb-2">Expected score:</label>
    <div class="row mb-4">
        <div class="col d-flex justify-content-center align-items-center"></div>

        <div class="col d-flex justify-content-center align-items-center">
            <div class="text-center fs-3">
                <span class="badge bg-{{ armwrestler_color[0] }}">{{ expected_five_score1 }}</span>
            </div>
        </div>
        
        <div class="col-1 d-flex justify-content-center align-items-center text-center fs-2">:</div>

        <div class="col d-flex justify-content-center align-items-center">
            <div class="text-center fs-3">
                <span class="badge bg-{{ armwrestler_color[1] }}">{{ expected_five_score2 }}</span>
            </div>
        </div>

        <div class="col d-flex justify-content-center align-items-center"></div>
    </div> 
    <div class="row mb-4">
        <div class="col">
            <div class="progress" style="height: 2.5rem;" >
                <div class="progress-bar bg-{{ armwrestler_color[0] }}" role="progressbar" style="width: {{ expected_1 }}%" aria-valuenow="{{ expected_1 }}" aria-valuemin="0" aria-valuemax="100">{{ expected_1 }}</div>
                <div class="progress-bar bg-{{ armwrestler_color[1] }}" role="progressbar" style="width: {{ expected_2 }}%" aria-valuenow="{{ expected_2 }}" aria-valuemin="0" aria-valuemax="100">{{ expected_2 }}</div>
            </div>
        </div>
    </div>

    <label for="win_chance" class="form-label mb-2">Win chance (expected score confidence - 5):</label>
    <div class="row mb-4">
        <div class="col">
            <div class="progress" style="height: 2.5rem;" >
                <div class="progress-bar bg-{{ armwrestler_color[0] }}" role="progressbar" style="width: {{ beta_predicted_1 }}%" aria-valuenow="{{ beta_predicted_1 }}" aria-valuemin="0" aria-valuemax="100">{{ beta_predicted_1 }}%</div>
                <div class="progress-bar bg-{{ armwrestler_color[1] }}" role="progressbar" style="width: {{ beta_predicted_2 }}%" aria-valuenow="{{ beta_predicted_2 }}" aria-valuemin="0" aria-valuemax="100">{{ beta_predicted_2 }}%</div>
            </div>
        </div>
    </div>
    <div class="alert alert-secondary mb-2" role="alert">
        The win chance uses the beta distribution to determine the likelihood of an armwrestler winning/losing the match in percent. The parameters of the distribution are set such that the expected score is the mean, and the expected score confidence is the value to control the distribution's spread. The probability of an armwrestler winning is then the integral of the part of the distribution where the armwrestler wins.
    </div>
    {% endif %}
</form>

